<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥åº·è—¥å±€ - ç·šä¸Šé è¨‚</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f3f4f6; }
    </style>
</head>
<body class="p-6">

    <header class="max-w-4xl mx-auto mb-8 text-center">
        <h1 class="text-3xl font-bold text-blue-600 mb-2">ğŸ¥ å¥åº·è—¥å±€ç·šä¸Šé è¨‚</h1>
        <p class="text-gray-600">è«‹é¸æ“‡éœ€è¦çš„å•†å“ï¼Œä¸¦å¡«å¯«é è¨‚è³‡è¨Š</p>
    </header>

    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <div class="md:col-span-2 space-y-4">
            
            <div id="filter-buttons" class="flex flex-wrap gap-2 mb-4">
                </div>

            <div id="product-list" class="space-y-4">
                </div>
        </div>
            </div>

       <div class="bg-white p-6 rounded-lg shadow-lg h-fit sticky top-6">
            <h2 class="text-xl font-bold mb-4 border-b pb-2">ğŸ›’ æ‚¨çš„è³¼ç‰©è»Š</h2>
            <div id="cart-items" class="space-y-2 mb-4 text-sm text-gray-700 max-h-60 overflow-y-auto">
                <p class="text-gray-400">ç›®å‰è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>
            </div>
            
            <div class="flex justify-between font-bold text-lg mb-6 border-t pt-4">
                <span>ç¸½é‡‘é¡ï¼š</span>
                <span id="total-price" class="text-blue-600">$0</span>
            </div>

            <form id="order-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">æ”¶ä»¶äººå§“å</label>
                    <input type="text" placeholder="è«‹è¼¸å…¥å§“å" required class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">è¯çµ¡é›»è©±</label>
                    <input type="tel" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼" required class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div class="bg-blue-50 p-3 rounded-lg border border-blue-100">
                    <label class="block font-bold text-blue-800 mb-2">ğŸ“¦ è«‹é¸æ“‡å–è²¨æ–¹å¼</label>
                    
                    <div class="space-y-2">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery" value="store" checked onclick="toggleDelivery('store')" class="mr-2 w-4 h-4 text-blue-600">
                            <span>ğŸ¥ è—¥å±€åº—å–</span>
                        </label>
                        
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery" value="711" onclick="toggleDelivery('711')" class="mr-2 w-4 h-4 text-blue-600">
                            <span>ğŸª 7-11 å–è²¨</span>
                        </label>

                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="delivery" value="mail" onclick="toggleDelivery('mail')" class="mr-2 w-4 h-4 text-blue-600">
                            <span>ğŸšš éƒµå¯„å®…é…</span>
                        </label>
                    </div>

                    <div class="mt-3 pt-3 border-t border-blue-200">
                        
                        <div id="field-store">
                            <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ“… é è¨ˆå–è²¨æ™‚é–“</label>
                            <input type="datetime-local" id="input-store-time" class="w-full p-2 border rounded bg-white">
                        </div>

                        <div id="field-711" class="hidden">
                            <label class="block text-sm font-bold text-gray-700 mb-1">ğŸª 7-11 åº—å/åº—è™Ÿ</label>
                            <input type="text" id="input-711-store" placeholder="ä¾‹å¦‚: çµ±ä¸€é–€å¸‚ (123456)" class="w-full p-2 border rounded bg-white">
                        </div>

                        <div id="field-mail" class="hidden">
                            <label class="block text-sm font-bold text-gray-700 mb-1">ğŸ  å®Œæ•´å¯„é€åœ°å€</label>
                            <input type="text" id="input-mail-address" placeholder="ç¸£å¸‚/å€/è·¯/è™Ÿ/æ¨“" class="w-full p-2 border rounded bg-white">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">å‚™è¨» (é¸å¡«)</label>
                    <textarea placeholder="å…¶ä»–éœ€æ±‚èªªæ˜..." class="w-full p-2 border rounded focus:ring-2 focus:ring-blue-500 outline-none h-20"></textarea>
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition shadow-lg transform active:scale-95">
                    é€å‡ºé è¨‚å–®
                </button>
            </form>
        </div>
    </div>

    <script>
        // 1. è¨­å®šå•†å“è³‡æ–™ 
        const products = [
            { 
                id: 1, 
                name: "ç¶œåˆç¶­ä»–å‘½ Bç¾¤", 
                price: 600, 
                tag: "ä¿å¥", 
                image: "images/1.jpg", 
                desc: "å«é«˜å–®ä½ B1ã€B6ã€B12ï¼Œå¢å¼·é«”åŠ›ï¼Œä¸Šç­æ—å¿…å‚™ã€‚"
            },
            { 
                id: 2, 
                name: "é†«ç™‚ç”¨å£ç½© (50å…¥)", 
                price: 250, 
                tag: "é˜²ç–«", 
                image: "images/2.jpg",
                desc: "ä¸‰å±¤é˜²è­·çµæ§‹ï¼Œå°ç£è£½é€ ï¼Œé€æ°£èˆ’é©ä¸æ‚¶ç†±ã€‚"
            },
            { 
                id: 3, 
                name: "è‘‰é»ƒç´ è† å›Š", 
                price: 1200, 
                tag: "ä¿å¥", 
                image: "images/3.jpg",
                desc: "æ¸¸é›¢å‹è‘‰é»ƒç´ å¥½å¸æ”¶ï¼Œä¿è­·æ™¶äº®ï¼Œé©åˆé•·æ™‚é–“ç”¨çœ¼è€…ã€‚"
            },
            { 
                id: 4, 
                name: "é…’ç²¾å™´éœ§ 500ml", 
                price: 150, 
                tag: "é˜²ç–«", 
                image: "images/4.jpg",
                desc: "75% é†«ç™‚ç´šé…’ç²¾ï¼Œå±…å®¶ç’°å¢ƒæ¶ˆæ¯’ã€æ‰‹éƒ¨æ¸…æ½”çš†é©ç”¨ã€‚"
            },
            { 
                id: 5, 
                name: "ç— ç—›è²¼å¸ƒ (10ç‰‡)", 
                price: 300, 
                tag: "å¤–ç”¨", 
                image: "images/5.jpg",
                desc: "æ·»åŠ è–„è·ç²¾æ²¹ï¼Œæ¸…æ¶¼èˆ’ç·©ï¼Œé©ç”¨è‚©é ¸è…°èƒŒç— ç—›ã€‚"
            },
        ];

        let cart = [];
        let currentFilter = 'å…¨éƒ¨';

        // 2. åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderFilterButtons();
            renderProducts(products);
            
            // è¨­å®šé è¨­æ™‚é–“
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            const timeInput = document.getElementById('input-store-time');
            if(timeInput) timeInput.value = now.toISOString().slice(0, 16);
        });

        // 3. åˆ‡æ›é¡¯ç¤º
        function toggleDelivery(method) {
            document.getElementById('field-store').classList.add('hidden');
            document.getElementById('field-711').classList.add('hidden');
            document.getElementById('field-mail').classList.add('hidden');

            if (method === 'store') {
                document.getElementById('field-store').classList.remove('hidden');
            } else if (method === '711') {
                document.getElementById('field-711').classList.remove('hidden');
            } else if (method === 'mail') {
                document.getElementById('field-mail').classList.remove('hidden');
            }
        }

        // 4. æ¸²æŸ“æŒ‰éˆ•
        function renderFilterButtons() {
            const btnContainer = document.getElementById('filter-buttons');
            const tags = ['å…¨éƒ¨', ...new Set(products.map(p => p.tag))];
            btnContainer.innerHTML = tags.map(tag => `
                <button onclick="filterProducts('${tag}')" 
                    class="px-4 py-1 rounded-full text-sm font-bold border transition
                    ${tag === currentFilter 
                        ? 'bg-blue-600 text-white border-blue-600 shadow-md' 
                        : 'bg-white text-gray-600 border-gray-300 hover:bg-gray-100'}">
                    ${tag}
                </button>
            `).join('');
        }

        // 5. ç¯©é¸
        function filterProducts(category) {
            currentFilter = category;
            renderFilterButtons();
            if (category === 'å…¨éƒ¨') renderProducts(products);
            else renderProducts(products.filter(p => p.tag === category));
        }

        // â˜… æ–°åŠŸèƒ½ï¼šæ•¸é‡é©—è­‰ (å®¢äººæ‰‹å‹•è¼¸å…¥æ•¸å­—æ™‚ï¼Œé˜²æ­¢è¼¸å…¥ 0 æˆ–è² æ•¸)
        function validateQty(input) {
            let val = parseInt(input.value);
            // å¦‚æœä¸æ˜¯æ•¸å­—ï¼Œæˆ–æ˜¯å°æ–¼ 1ï¼Œå°±å¼·åˆ¶è®Šå› 1
            if (isNaN(val) || val < 1) {
                input.value = 1;
            } else {
                input.value = val; // ç¢ºä¿æ˜¯æ•´æ•¸ (å»é™¤å°æ•¸é»)
            }
        }

        // â˜… æ§åˆ¶å•†å“åˆ—è¡¨ä¸Šçš„æ•¸é‡æŒ‰éˆ•
        function adjustProductQty(id, change) {
            const input = document.getElementById(`qty-input-${id}`);
            let currentVal = parseInt(input.value);
            if (isNaN(currentVal)) currentVal = 1; // é˜²å‘†

            let newVal = currentVal + change;
            if (newVal < 1) newVal = 1; // æœ€å°ä¸èƒ½å°æ–¼ 1
            input.value = newVal;
        }

        // 6. æ¸²æŸ“å•†å“ (ä¿®æ”¹ï¼šè¼¸å…¥æ¡†æ‹¿æ‰ readonlyï¼ŒåŠ å…¥ onchange æª¢æŸ¥)
        function renderProducts(list) {
            const productListEl = document.getElementById('product-list');
            if(list.length === 0) {
                productListEl.innerHTML = '<div class="text-gray-500 text-center py-8">æ²’æœ‰æ‰¾åˆ°ç›¸é—œå•†å“</div>';
                return;
            }
            productListEl.innerHTML = list.map(product => `
                <div class="bg-white p-4 rounded-lg shadow flex flex-col sm:flex-row items-start sm:items-center gap-4">
                    <div class="flex-shrink-0">
                        <img src="${product.image}" alt="${product.name}" class="w-full sm:w-24 h-32 sm:h-24 object-cover rounded-md border border-gray-200">
                    </div>
                    
                    <div class="flex-grow min-w-0 w-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-xs font-bold text-blue-600 border border-blue-200 bg-blue-50 px-2 py-0.5 rounded-full mb-1 inline-block">${product.tag}</span>
                                <h3 class="font-bold text-lg text-gray-800 leading-tight">${product.name}</h3>
                            </div>
                            <p class="text-blue-600 font-bold ml-2 shrink-0 text-lg">$${product.price}</p>
                        </div>
                        <p class="text-sm text-gray-500 mt-1 mb-2 leading-snug">${product.desc}</p>
                    </div>

                    <div class="flex-shrink-0 w-full sm:w-auto flex items-center justify-between sm:justify-end gap-3 mt-2 sm:mt-0">
                        
                        <div class="flex items-center border border-gray-300 rounded-lg overflow-hidden">
                            <button onclick="adjustProductQty(${product.id}, -1)" class="w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold active:bg-gray-300 transition">-</button>
                            
                            <input type="number" id="qty-input-${product.id}" value="1" min="1" onchange="validateQty(this)" class="w-12 h-8 text-center text-gray-800 font-bold border-x border-gray-300 outline-none">
                            
                            <button onclick="adjustProductQty(${product.id}, 1)" class="w-8 h-8 flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-blue-600 font-bold active:bg-gray-300 transition">+</button>
                        </div>
                        
                        <button onclick="addToCart(${product.id})" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md transition whitespace-nowrap active:scale-95 flex items-center">
                            <span>+ åŠ å…¥</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // 7. è³¼ç‰©è»Šæ“ä½œ
        function addToCart(id) {
            const qtyInput = document.getElementById(`qty-input-${id}`);
            // å†åšä¸€æ¬¡é©—è­‰ï¼Œç¢ºä¿é€å‡ºå‰æ•¸å­—æ˜¯æ­£ç¢ºçš„
            validateQty(qtyInput);
            const qty = parseInt(qtyInput.value);
            
            const product = products.find(p => p.id === id);
            const existingItem = cart.find(item => item.product.id === id);
            if (existingItem) existingItem.qty += qty;
            else cart.push({ product: product, qty: qty });
            
            updateCart();
            qtyInput.value = 1; 
        }

        function changeQty(index, change) {
            cart[index].qty += change;
            if (cart[index].qty <= 0) {
                if(confirm(`ç¢ºå®šè¦ç§»é™¤ ${cart[index].product.name} å—ï¼Ÿ`)) cart.splice(index, 1);
                else cart[index].qty = 1;
            }
            updateCart();
        }

        function updateCart() {
            const cartEl = document.getElementById('cart-items');
            const totalEl = document.getElementById('total-price');
            if (cart.length === 0) {
                cartEl.innerHTML = '<p class="text-gray-400">ç›®å‰è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>';
                totalEl.innerText = '$0';
                return;
            }
            cartEl.innerHTML = cart.map((item, index) => `
                <div class="flex justify-between items-center border-b pb-2 pt-2">
                    <div class="flex-grow">
                        <div class="text-gray-800 font-medium">${item.product.name}</div>
                        <div class="text-xs text-gray-500">å–®åƒ¹ $${item.product.price}</div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="changeQty(${index}, -1)" class="bg-gray-200 w-6 h-6 rounded text-gray-600 hover:bg-gray-300 font-bold flex items-center justify-center">-</button>
                        <span class="w-6 text-center font-bold text-sm">${item.qty}</span>
                        <button onclick="changeQty(${index}, 1)" class="bg-gray-200 w-6 h-6 rounded text-gray-600 hover:bg-gray-300 font-bold flex items-center justify-center">+</button>
                    </div>
                    <div class="ml-4 font-bold text-blue-600 w-16 text-right">$${item.product.price * item.qty}</div>
                </div>
            `).join('');
            const total = cart.reduce((sum, item) => sum + (item.product.price * item.qty), 0);
            totalEl.innerText = '$' + total;
        }

        // 8. é€å‡ºè¡¨å–®
        document.getElementById('order-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if(cart.length === 0) {
                alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼");
                return;
            }

            const name = this.querySelector('input[type="text"]').value;
            const phone = this.querySelector('input[type="tel"]').value;
            const noteEl = this.querySelector('textarea');
            const note = noteEl ? noteEl.value : "";
            
            const deliveryMethod = document.querySelector('input[name="delivery"]:checked').value;
            let deliveryInfo = "";
            let methodText = "";

            if (deliveryMethod === 'store') {
                methodText = "ğŸ¥ è—¥å±€åº—å–";
                const timeInput = document.getElementById('input-store-time');
                const time = timeInput ? timeInput.value.replace('T', ' ') : "æœªæŒ‡å®šæ™‚é–“";
                deliveryInfo = `é è¨ˆå–è²¨ï¼š${time}`;
            } else if (deliveryMethod === '711') {
                methodText = "ğŸª 7-11 å–è²¨";
                const storeName = document.getElementById('input-711-store').value;
                if(!storeName) { alert("è«‹è¼¸å…¥ 7-11 åº—å"); return; }
                deliveryInfo = `é–€å¸‚åç¨±ï¼š${storeName}`;
            } else if (deliveryMethod === 'mail') {
                methodText = "ğŸšš éƒµå¯„å®…é…";
                const address = document.getElementById('input-mail-address').value;
                if(!address) { alert("è«‹è¼¸å…¥å¯„é€åœ°å€"); return; }
                deliveryInfo = `å¯„é€åœ°å€ï¼š${address}`;
            }

            const total = cart.reduce((sum, item) => sum + (item.product.price * item.qty), 0);
            
            let message = `ã€æ–°è¨‚å–®è©¢åƒ¹ã€‘\n`; 
            message += `----------------\n`;
            message += `å§“åï¼š${name}\n`;
            message += `é›»è©±ï¼š${phone}\n`;
            message += `æ–¹å¼ï¼š${methodText}\n`;
            message += `${deliveryInfo}\n`;
            message += `----------------\n`;
            message += `éœ€æ±‚å•†å“ï¼š\n`;
            cart.forEach(item => {
                message += `â— ${item.product.name} x ${item.qty} ($${item.product.price * item.qty})\n`;
            });
            message += `----------------\n`;
            message += `ç¸½é‡‘é¡ï¼š$${total}\n`;
            if(note) {
                message += `å‚™è¨»ï¼š${note}\n`;
            }
            message += `----------------\n`;
            message += `(è«‹è—¥å¸«ç¢ºèªåº«å­˜å¾Œï¼Œé€šçŸ¥æˆ‘ä»˜æ¬¾ï¼Œè¬è¬)`;

            // â˜…â˜…â˜… è¨˜å¾—æ”¹ LINE ID â˜…â˜…â˜…
            const lineID = "@175yhxos"; 
            const lineUrl = "https://line.me/R/oaMessage/" + lineID + "/?" + encodeURIComponent(message);

            alert("å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡è³¼ç‰©ï¼Œè«‹å…ˆåŠ å…¥å®˜æ–¹LINEä¸¦é€å‡ºè¨‚å–®ï¼Œåº—é•·æœƒç¢ºèªåº«å­˜å¾Œå›è¦†æ‚¨ä»˜æ¬¾æ–¹å¼å”·!");

            window.location.href = lineUrl;
        });
    </script>
</body>

</html>






